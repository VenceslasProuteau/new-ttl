(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{31:function(e,t,n){},59:function(e,t,n){},62:function(e,t,n){},63:function(e,t,n){},69:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(33),c=n.n(i),s=n(17),o=n(3),u=n(11),l=n(12),d=n(15),j=n(14),h=n(4),m=n(16),p=n.n(m),b=n(34),O=n.n(b);var f=new function(){return{getAuthToken:function(){return p.a.get("authToken")}}};var v=new function(e){return{login:function(t){return e.call({method:"POST",url:"/user/login",data:t})},signUp:function(t){return e.call({method:"POST",url:"/user/signup",data:t})}}}(new function(e){return{call:function(e){return O()(Object(o.a)(Object(o.a)({},e),{},{url:"".concat("/api/v1").concat(e.url),method:e.method||"GET"})).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e}))},callAuth:function(t){var n=this;return e.getAuthToken().then((function(e){return n.call(Object(o.a)(Object(o.a)({},t),{},{headers:Object(o.a)(Object(o.a)({},t.headers),{},{token:e})}))}))}}}(f)),g="authToken",x=function(){function e(){Object(u.a)(this,e),this.clientCache={}}return Object(l.a)(e,[{key:"get",value:function(){return this.clientCache}},{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.clientCache=Object(o.a)(Object(o.a)({},this.clientCache),e)}},{key:"reset",value:function(){this.clientCache={}}}]),e}();var w=new function(e){var t=new x;return{getDomain:function(){window.location.hostname.split(".").slice(-2).join(".")},logout:function(){var e=this.getDomain();p.a.remove(g,{domain:e}),t.reset()},login:function(t){var n=this;return e.login(t).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data.token;p.a.set(g,t,{expires:30,domain:n.getDomain()})})).catch((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.response.data;return Promise.reject(t)}))},signUp:function(t){return e.signUp(t).catch((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.response.data;return Promise.reject(t)}))},isAuthenticated:function(){return!!p.a.get(g)}}}(v),L=(n(59),n(1)),S=function(e){return function(t){return w.isAuthenticated()?Object(L.jsxs)(r.a.Fragment,{children:[Object(L.jsx)("div",{className:"app__menu-toggle"}),Object(L.jsx)("div",{className:"app",children:Object(L.jsx)("div",{className:"layout-container",children:Object(L.jsx)(e,Object(o.a)({},t))})})]}):(t.history.replace({pathname:G.LOGIN.path,search:"?redirectUrl=".concat(t.location.pathname)}),null)}},N=n(13),y=n(10),A=n(35),k=n.n(A),_=(n(62),function(){return Object(L.jsx)("div",{className:"spinner-container",children:Object(L.jsx)("div",{className:"spinner"})})}),C=(n(63),function(e){var t=e.name,n=void 0===t?[]:t,a=e.when,r=void 0===a?[]:a,i=e.message,c=void 0===i?"":i;return Object(L.jsx)(y.a,{name:n,subscription:{submitFailed:!0,error:!0,active:!0},render:function(e){var t=e.meta,n=t.submitFailed,a=t.error;return!t.active&&n&&a&&(!r||r.indexOf(a)>=0)?Object(L.jsx)("span",{className:"form-error-message",children:c||a}):null}})}),R=/.+@.+\..+/,U=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce((function(t,n){return t||n(e)}),void 0)}},D=function(e){return e?void 0:"required"},E=function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return new RegExp(e).test(t)?void 0:"pattern"}},I=function(e){return e.length<9?"passwordLength":void 0},T=(n(31),{NOT_EXISTING_USER:"L'email renseign\xe9 n'existe pas",INVALID_PASSWORD:"Le mot de passe renseign\xe9 est incorrect"}),q=function(e){Object(d.a)(n,e);var t=Object(j.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).redirectUrl=k.a.parse(e.location.search).redirectUrl,a.onLogin=a.onLogin.bind(Object(N.a)(a)),a.state={error:!1},a}return Object(l.a)(n,[{key:"onLogin",value:function(e){var t=this;return this.setState({isLoading:!0}),w.login(e).then((function(){if(!t.redirectUrl)return t.props.history.replace(G.DASHBOARD.path);window.location.href="".concat(window.location.origin).concat(t.redirectUrl)})).catch((function(e){var n=e.error;return t.setState({error:n,isLoading:!1})}))}},{key:"render",value:function(){var e=this;return this.state.isLoading?Object(L.jsx)(_,{}):Object(L.jsx)("div",{className:"authent-page",children:Object(L.jsx)("div",{className:"authent-page__form-container",children:Object(L.jsx)(y.b,{onSubmit:this.onLogin,render:function(t){var n=t.handleSubmit;return Object(L.jsxs)("form",{onSubmit:n,autoComplete:"off",children:[Object(L.jsx)(y.a,{name:"email",validate:U(D,E(R)),children:function(e){var t=e.input;return Object(L.jsx)("input",Object(o.a)(Object(o.a)({},t),{},{type:"email",placeholder:"Email",name:"email"}))}}),Object(L.jsx)(y.a,{name:"password",validate:U(D),children:function(e){var t=e.input;return Object(L.jsx)("input",Object(o.a)(Object(o.a)({},t),{},{type:"password",placeholder:"Mot de passe",name:"password"}))}}),Object(L.jsxs)("div",{className:"form-error-message",children:[Object(L.jsx)(C,{name:"email",when:["required"],message:"L'email est requis"}),Object(L.jsx)(C,{name:"email",when:["pattern"],message:"Le format de l'email renseign\xe9 est incorrect"}),Object(L.jsx)(C,{name:"password",when:["required"],message:"Le mot de passe est requis"}),e.state.error&&Object(L.jsx)("span",{children:T[e.state.error]})]}),Object(L.jsx)("button",{className:"button",type:"submit",children:"Se connecter"}),Object(L.jsxs)("div",{className:"authent-page__signup",children:["Vous n'avez pas encore de compte ? ",Object(L.jsx)(s.b,{to:"/signup",className:"page__inlined-link",children:"Rejoignez notre communaut\xe9 d\xe8s maintenant !"})]})]})}})})})}}]),n}(a.Component),H={USER_EXISTING:"Un compte est d\xe9j\xe0 enregistr\xe9 avec cet email",TECHNICAL_ERROR:"Une erreur est survenue, merci de r\xe9essayer"},B=function(e){Object(d.a)(n,e);var t=Object(j.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).signup=a.signup.bind(Object(N.a)(a)),a.login=a.login.bind(Object(N.a)(a)),a.state={isLoading:!1},a}return Object(l.a)(n,[{key:"signup",value:function(e){var t=this;return this.setState({isLoading:!0,form:e}),w.signUp(e).then((function(){t.setState({isAccountCreated:!0,isLoading:!1})})).catch((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.error,a=void 0===n?"TECHNICAL_ERROR":n;t.setState({error:a,isLoading:!1})}))}},{key:"login",value:function(){var e=this;return this.setState({isLoading:!0}),w.login(this.state.form).then((function(){e.props.history.replace(G.DASHBOARD.path)}))}},{key:"render",value:function(){var e=this;return this.state.isLoading?Object(L.jsx)(_,{}):Object(L.jsx)("div",{className:"authent-page",children:Object(L.jsx)("div",{className:"authent-page__form-container",children:Object(L.jsx)(y.b,{onSubmit:this.signup,render:function(t){var n=t.handleSubmit;return e.state.isAccountCreated?Object(L.jsxs)(r.a.Fragment,{children:[Object(L.jsxs)("div",{className:"authent-page__account-created",children:["Bienvenue dans la commu ",e.state.form.username," !"]}),Object(L.jsx)("button",{onClick:e.login,children:"Se connecter"})]}):Object(L.jsxs)("form",{onSubmit:n,autoComplete:"off",children:[Object(L.jsx)(y.a,{name:"email",validate:U(D,E(R)),children:function(e){var t=e.input;return Object(L.jsx)("input",Object(o.a)(Object(o.a)({},t),{},{type:"email",placeholder:"Email",name:"email"}))}}),Object(L.jsx)(y.a,{name:"username",validate:U(D),children:function(e){var t=e.input;return Object(L.jsx)("input",Object(o.a)(Object(o.a)({},t),{},{type:"text",placeholder:"Username",name:"username"}))}}),Object(L.jsx)(y.a,{name:"password",validate:U(D,I),children:function(e){var t=e.input;return Object(L.jsx)("input",Object(o.a)(Object(o.a)({},t),{},{type:"password",placeholder:"Mot de passe",name:"password"}))}}),Object(L.jsxs)("div",{className:"form-error-message",children:[Object(L.jsx)(C,{name:"email",when:["required"],message:"L'email est requis"}),Object(L.jsx)(C,{name:"email",when:["pattern"],message:"Le format de l'email renseign\xe9 est incorrect"}),Object(L.jsx)(C,{name:"password",when:["required"],message:"Le mot de passe est requis"}),Object(L.jsx)(C,{name:"password",when:["passwordLength"],message:"Le mot de passe doit faire au moins 9 caract\xe8res"}),e.state.error&&Object(L.jsx)("span",{children:H[e.state.error]})]}),Object(L.jsx)("button",{type:"submit",children:"Rejoindre la communaut\xe9"})]})}})})})}}]),n}(a.Component),G={HOME:{path:"/",exact:!0,component:S((function(e){return e.history.replace(G.DASHBOARD.path),null}))},LOGIN:{path:"/login",component:q},SIGNUP:{path:"/signup",component:B},DASHBOARD:{path:"/dashboard",component:S((function(){return Object(L.jsx)("div",{children:"Dashboard"})}))}},P=function(e){Object(d.a)(n,e);var t=Object(j.a)(n);function n(e){return Object(u.a)(this,n),t.call(this,e)}return Object(l.a)(n,[{key:"render",value:function(){return Object.values(G).map((function(e,t){return Object(L.jsx)(h.a,{path:e.path,exact:e.exact,render:function(t){return Object(L.jsx)(e.component,Object(o.a)({},t))}},t)}))}}]),n}(r.a.Component);c.a.render(Object(L.jsx)(s.a,{children:Object(L.jsx)(P,{})}),document.getElementById("root"))}},[[69,1,2]]]);
//# sourceMappingURL=main.23046fbe.chunk.js.map