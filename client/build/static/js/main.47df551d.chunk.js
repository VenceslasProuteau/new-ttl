(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{58:function(e,t,n){},61:function(e,t,n){},62:function(e,t,n){},63:function(e,t,n){},69:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(32),c=n.n(i),o=n(20),s=n(3),u=n(11),l=n(12),h=n(15),d=n(14),j=n(4),p=n(16),m=n.n(p),b=n(33),O=n.n(b);var f=new function(){return{getAuthToken:function(){return m.a.get("authToken")}}};var v=new function(e){return{login:function(t){return e.call({method:"POST",url:"/user/login",data:t})},signUp:function(t){return e.call({method:"POST",url:"/user/signup",data:t})}}}(new function(e){return{call:function(e){return O()(Object(s.a)(Object(s.a)({},e),{},{url:"".concat("/api/v1").concat(e.url),method:e.method||"GET"})).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e}))},callAuth:function(t){var n=this;return e.getAuthToken().then((function(e){return n.call(Object(s.a)(Object(s.a)({},t),{},{headers:Object(s.a)(Object(s.a)({},t.headers),{},{token:e})}))}))}}}(f)),g="authToken",x=function(){function e(){Object(u.a)(this,e),this.clientCache={}}return Object(l.a)(e,[{key:"get",value:function(){return this.clientCache}},{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.clientCache=Object(s.a)(Object(s.a)({},this.clientCache),e)}},{key:"reset",value:function(){this.clientCache={}}}]),e}();var w=new function(e){var t=new x;return{getDomain:function(){window.location.hostname.split(".").slice(-2).join(".")},logout:function(){var e=this.getDomain();m.a.remove(g,{domain:e}),t.reset()},login:function(t){var n=this;return e.login(t).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data.token;m.a.set(g,t,{expires:30,domain:n.getDomain()})})).catch((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.response.data;return Promise.reject(t)}))},signUp:function(t){var n=this;return e.signUp(t).then((function(){return n.login(t)}))},isAuthenticated:function(){return!!m.a.get(g)}}}(v),y=(n(58),n(1)),S=function(e){return function(t){return w.isAuthenticated()?Object(y.jsxs)(a.a.Fragment,{children:[Object(y.jsx)("div",{className:"app__menu-toggle"}),Object(y.jsx)("div",{className:"app",children:Object(y.jsx)("div",{className:"layout-container",children:Object(y.jsx)(e,Object(s.a)({},t))})})]}):(t.history.replace({pathname:G.LOGIN.path,search:"?redirectUrl=".concat(t.location.pathname)}),null)}},L=n(13),k=n(10),A=n(34),N=n.n(A),D=(n(61),function(){return Object(y.jsx)("div",{className:"spinner-container",children:Object(y.jsx)("div",{className:"spinner"})})}),U=(n(62),function(e){var t=e.name,n=void 0===t?[]:t,r=e.when,a=void 0===r?[]:r,i=e.message,c=void 0===i?"":i;return Object(y.jsx)(k.a,{name:n,subscription:{submitFailed:!0,error:!0,active:!0},render:function(e){var t=e.meta,n=t.submitFailed,r=t.error;return!t.active&&n&&r&&(!a||a.indexOf(r)>=0)?Object(y.jsx)("span",{className:"form-error-message",children:c||r}):null}})}),C=/.+@.+\..+/,T=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce((function(t,n){return t||n(e)}),void 0)}},E=function(e){return e?void 0:"required"},I=function(e){return e.length<9?"passwordLength":void 0},R=(n(63),{NOT_EXISTING_USER:"L'email renseign\xe9 n'existe pas",INVALID_PASSWORD:"Le mot de passe renseign\xe9 est incorrect"}),q=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(u.a)(this,n),(r=t.call(this,e)).redirectUrl=N.a.parse(e.location.search).redirectUrl,r.onLogin=r.onLogin.bind(Object(L.a)(r)),r.state={error:!1},r}return Object(l.a)(n,[{key:"onLogin",value:function(e){var t=this;return this.setState({isLoading:!0}),w.login(e).then((function(){if(!t.redirectUrl)return t.props.history.replace(G.DASHBOARD.path);window.location.href="".concat(window.location.origin).concat(t.redirectUrl)})).catch((function(e){var n=e.error;return t.setState({error:n,isLoading:!1})}))}},{key:"render",value:function(){var e=this;return this.state.isLoading?Object(y.jsx)(D,{}):Object(y.jsx)("div",{className:"login",children:Object(y.jsx)(k.b,{onSubmit:this.onLogin,render:function(t){var n,r=t.handleSubmit;return Object(y.jsxs)("form",{onSubmit:r,autoComplete:"off",children:[Object(y.jsx)(k.a,{name:"email",validate:T(E,(n=C,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return new RegExp(n).test(e)?void 0:"pattern"})),children:function(e){var t=e.input;return Object(y.jsx)("input",Object(s.a)(Object(s.a)({},t),{},{type:"email",placeholder:"Email",name:"email"}))}}),Object(y.jsx)(k.a,{name:"password",validate:T(E,I),children:function(e){var t=e.input;return Object(y.jsx)("input",Object(s.a)(Object(s.a)({},t),{},{type:"password",placeholder:"Mot de passe",name:"password"}))}}),Object(y.jsxs)("div",{className:"form-error-message",children:[Object(y.jsx)(U,{name:"email",when:["required"],message:"L'email est requis"}),Object(y.jsx)(U,{name:"email",when:["pattern"],message:"Le format de l'email renseign\xe9 est incorrect"}),Object(y.jsx)(U,{name:"password",when:["required"],message:"Le mot de passe est requis"}),Object(y.jsx)(U,{name:"password",when:["passwordLength"],message:"Le mot de passe doit faire au moins 9 chiffres ou caract\xe8res"}),e.state.error&&Object(y.jsx)("span",{children:R[e.state.error]})]}),Object(y.jsx)("button",{className:"button",type:"submit",children:"Se connecter"})]})}})})}}]),n}(r.Component),B=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(u.a)(this,n),(r=t.call(this,e)).signup=r.signup.bind(Object(L.a)(r)),r}return Object(l.a)(n,[{key:"signup",value:function(e){var t=this;return this.setState({isLoading:!0}),w.signUp(e).then((function(){return t.props.history.replace(G.DASHBOARD.path)})).catch((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.errors,r=void 0===n?[]:n;t.setState({errors:r,isLoading:!1})}))}},{key:"render",value:function(){return Object(y.jsx)("div",{className:"signup",children:Object(y.jsx)(k.b,{onSubmit:this.signup,render:function(e){var t=e.handleSubmit;return Object(y.jsxs)("form",{onSubmit:t,autoComplete:"off",children:[Object(y.jsx)(k.a,{name:"email",children:function(e){var t=e.input;return Object(y.jsx)("input",Object(s.a)(Object(s.a)({},t),{},{type:"email",placeholder:"Email",name:"email"}))}}),Object(y.jsx)(k.a,{name:"username",children:function(e){var t=e.input;return Object(y.jsx)("input",Object(s.a)(Object(s.a)({},t),{},{type:"text",placeholder:"Username",name:"username"}))}}),Object(y.jsx)(k.a,{name:"password",children:function(e){var t=e.input;return Object(y.jsx)("input",Object(s.a)(Object(s.a)({},t),{},{type:"password",placeholder:"Mot de passe",name:"password"}))}}),Object(y.jsx)("input",{type:"submit",value:"Cr\xe9er mon compte"})]})}})})}}]),n}(r.Component),G={HOME:{path:"/",exact:!0,component:S((function(e){return e.history.replace(G.DASHBOARD.path),null}))},LOGIN:{path:"/login",component:q},SIGNUP:{path:"/signup",component:B},DASHBOARD:{path:"/dashboard",component:S((function(){return Object(y.jsx)("div",{children:"Dashboard"})}))}},H=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(u.a)(this,n),t.call(this,e)}return Object(l.a)(n,[{key:"render",value:function(){return Object.values(G).map((function(e,t){return Object(y.jsx)(j.a,{path:e.path,exact:e.exact,render:function(t){return Object(y.jsx)(e.component,Object(s.a)({},t))}},t)}))}}]),n}(a.a.Component);c.a.render(Object(y.jsx)(o.a,{children:Object(y.jsx)(H,{})}),document.getElementById("root"))}},[[69,1,2]]]);
//# sourceMappingURL=main.47df551d.chunk.js.map